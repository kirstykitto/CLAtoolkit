{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}{{title}}{% endblock %}

{% block heading %}{{title}}{% endblock %}

{% block body %}
<div class="row">
    <div class="col-lg-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> My Activity
                <div class="pull-right">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            Actions
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            <li><a href="#">Action</a>
                            </li>
                            <li><a href="#">Another action</a>
                            </li>
                            <li><a href="#">Something else here</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div id="pageview_chart"></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-8 -->
    <div class="col-lg-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bell fa-fw"></i> My Total Activity
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                  <div id="activity_pie"></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->

    </div>
    <!-- /.col-lg-4 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> My Social Network
                <div class="pull-right">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            Actions
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            <li><a href="#">Action</a>
                            </li>
                            <li><a href="#">Another action</a>
                            </li>
                            <li><a href="#">Something else here</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div id="mynetwork" style="height: 350px;"></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-8 -->
    <div class="col-lg-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bell fa-fw"></i> My Word Cloud
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
              <div id="tag_container"></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->

    </div>
    <!-- /.col-lg-4 -->
</div>
<!-- /.row -->
<div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-bell fa-fw"></i> My Content
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                  <div class="dataTable_wrapper">
                      <table class="table table-striped table-bordered table-hover" id="dataTables-topcontent">
                          <thead>
                              <tr>
                                  <th>Username</th>
                                  <th>Title</th>
                                  <th>Posted On</th>
                                  <th>Likes</th>
                                  <th>Shares</th>
                                  <th>Comments</th>
                              </tr>
                          </thead>
                          <tbody>
                            {{topcontenttable|safe}}
                          </tbody>
                      </table>
                  </div>
                  <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->

        </div>
        <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-bell fa-fw"></i> My Dashboard Reflections
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                  <div class="dataTable_wrapper">
                    {% for reflection in reflections %}
                    <p>
                    <strong>Date:</strong> {{reflection.created_at}} <br />
                    <strong>Strategy:</strong> {{reflection.strategy}}<br />
                    <strong>Rating:</strong> {{reflection.rating}}<br />
                    </p>
                    <hr/>
                    {% endfor %}
                    <form method="post" action="/dashboard/student_dashboard/">
                      {% csrf_token %}
                      <input type="hidden" name="course_code" value="{{course_code}}" />
                      <input type="hidden" name="platform" value="{{platform}}" />
                      <input type="hidden" name="username" value="{{username}}" />
                      <div class="form-group">
                          <label>How will you improve your community contribution?</label>
                          <textarea name="reflectiontext" class="form-control" rows="3"></textarea>
                      </div>
                      <div class="form-group">
                        <label>How do you rate your community contribution?</label>
                          <label class="radio-inline">
                              <input type="radio" name="rating"  value="Unhappy">Unhappy
                          </label>
                          <label class="radio-inline">
                              <input type="radio" name="rating"  value="Satisfied" checked>Satisfied
                          </label>
                          <label class="radio-inline">
                              <input type="radio" name="rating"  value="Happy">Happy
                          </label>
                      </div>
                      <button type="submit" class="btn btn-default">Save Reflection</button>
                    </form>
                  </div>
                  <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->

        </div>
        <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% endblock %}

{% block js_block %}
{% autoescape off %}
<script src="{% static 'js/vis.js'%}"></script>
<script src="http://mistic100.github.io/jQCloud/dist/jqcloud2/dist/jqcloud.min.js"></script>
<script>
$(function() {


  // Create Activity Chart
  $('#pageview_chart').highcharts('StockChart', {

      rangeSelector : {
          selected : 1
      },

      tooltip: {
          style: {
              width: '200px'
          },
          valueDecimals: 0
      },

      yAxis : {
          min: 0,
          title : {
              text : 'Activity'
          }
      },
      legend: {
          enabled: true
      },

      series : [{
          name : 'Posts',
          data : [{{ posts_timeline }}],
          id : 'dataseries'
      },{
          name : 'Shares',
          data : [{{ shares_timeline }}],
          id : 'dataseries1'
      },{
          name : 'Likes',
          data : [{{ likes_timeline }}],
          id : 'dataseries2'
      },{
          name : 'Comments',
          data : [{{ comments_timeline }}],
          id : 'dataseries3'
      }]
  });
  $('#dataTables-topcontent').DataTable({responsive: true});

    // Create the Activity Pie Chart
    $('#activity_pie').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title: {
            text: ' '
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Platform Activity',
            data: [{{activity_pie_series|safe}}]
        }]
    });

    // create a network
    var container = document.getElementById('mynetwork');
    var data = {{sna_json}};
    var options = {
        nodes: {
            shape: 'dot',
            size: 16
        },
        physics: {
            forceAtlas2Based: {
                gravitationalConstant: -26,
                centralGravity: 0.005,
                springLength: 230,
                springConstant: 0.18
            },
            maxVelocity: 146,
            solver: 'forceAtlas2Based',
            timestep: 0.35,
            stabilization: {iterations:300}
        }
    };
    var network = new vis.Network(container, data, options);

    var words = [{{tags|safe}}];

    $("#tag_container").jQCloud(words, {
    width: 300,
    height: 200,
    shape: 'rectangular'
    });


});
</script>
{% endautoescape %}
{% endblock %}
